# Runbook: –†–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

–ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–±–æ—è—Ö.

---

## –ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

| –ò–Ω—Ü–∏–¥–µ–Ω—Ç | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è |
|----------|-------------|---------------------|
| [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞](#1-–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö-–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞) | üî¥ Critical | 5-30 –º–∏–Ω |
| [–î–∏—Å–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω](#2-–¥–∏—Å–∫-–∑–∞–ø–æ–ª–Ω–µ–Ω) | üî¥ Critical | 10-60 –º–∏–Ω |
| [502/504 –æ—à–∏–±–∫–∏](#3-502504-–æ—à–∏–±–∫–∏) | üü† High | 5-15 –º–∏–Ω |
| [Seven.io –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç](#4-sevenio-–º–µ–¥–ª–µ–Ω–Ω–æ-–æ—Ç–≤–µ—á–∞–µ—Ç) | üü° Medium | 5-60 –º–∏–Ω |
| [–ú–∞—Å—Å–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –±–∞—Ç—á–µ–π](#5-–º–∞—Å—Å–æ–≤—ã–µ-–æ—à–∏–±–∫–∏-–±–∞—Ç—á–µ–π) | üü° Medium | 15-60 –º–∏–Ω |
| [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è](#6-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-–Ω–µ-–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è) | üî¥ Critical | 10-30 –º–∏–Ω |
| [–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ CPU/RAM](#7-–≤—ã—Å–æ–∫–∞—è-–Ω–∞–≥—Ä—É–∑–∫–∞-cpuram) | üü† High | 5-20 –º–∏–Ω |

---

## 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

### –°–∏–º–ø—Ç–æ–º—ã
- –û—à–∏–±–∫–∞ `ECONNREFUSED` –≤ –ª–æ–≥–∞—Ö
- –°–æ–æ–±—â–µ–Ω–∏–µ "Database connection failed"
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 500

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å MySQL
systemctl status mysql

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–ª—É—à–∞–µ—Ç –ª–∏ MySQL –ø–æ—Ä—Ç
netstat -tlnp | grep 3306

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
mysql -u hlr_user -p -h localhost hlr_checker -e "SELECT 1;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ MySQL
tail -100 /var/log/mysql/error.log
```

### –†–µ—à–µ–Ω–∏–µ

**–®–∞–≥ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ MySQL**
```bash
systemctl restart mysql
systemctl status mysql
```

**–®–∞–≥ 2: –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∏—Å–∫**
```bash
df -h
# –ï—Å–ª–∏ /var –∑–∞–ø–æ–ª–Ω–µ–Ω ‚Äî —Å–º. —Ä–∞–∑–¥–µ–ª "–î–∏—Å–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω"
```

**–®–∞–≥ 3: –ï—Å–ª–∏ MySQL –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–Ω—Ñ–∏–≥–∞
mysqld --help --verbose 2>&1 | head -20

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Ä–µ–∂–∏–º–µ
mysqld_safe --skip-grant-tables &
```

**–®–∞–≥ 4: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞ (–∫—Ä–∞–π–Ω–∏–π —Å–ª—É—á–∞–π)**
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å MySQL
systemctl stop mysql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
mysql -u root -p hlr_checker < /path/to/backup.sql

# –ó–∞–ø—É—Å—Ç–∏—Ç—å MySQL
systemctl start mysql
```

**–®–∞–≥ 5: –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
systemctl restart hlr-checker
```

---

## 2. –î–∏—Å–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω

### –°–∏–º–ø—Ç–æ–º—ã
- –û—à–∏–±–∫–∏ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥–∞—Ö
- MySQL –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h

# –ù–∞–π—Ç–∏ –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã
du -sh /* 2>/dev/null | sort -hr | head -20

# –ù–∞–π—Ç–∏ –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –≤ /var
du -sh /var/* 2>/dev/null | sort -hr | head -10

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
du -sh /var/log/*
```

### –†–µ—à–µ–Ω–∏–µ

**–®–∞–≥ 1: –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
```bash
# –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ systemd
journalctl --vacuum-time=3d
journalctl --vacuum-size=500M

# –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏ Nginx
truncate -s 0 /var/log/nginx/access.log
truncate -s 0 /var/log/nginx/error.log
```

**–®–∞–≥ 2: –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ MySQL**
```bash
mysql -u hlr_user -p hlr_checker << 'EOF'
-- –£–¥–∞–ª–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π (—ç–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –º–µ—Ä–∞)
DELETE FROM hlr_results WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);

-- –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –±–∞—Ç—á–∏
DELETE FROM hlr_batches WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);

-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
OPTIMIZE TABLE hlr_results;
OPTIMIZE TABLE hlr_batches;
EOF
```

**–®–∞–≥ 3: –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –ø–∞–∫–µ—Ç–æ–≤**
```bash
apt clean
apt autoremove -y
```

**–®–∞–≥ 4: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ Docker –æ–±—Ä–∞–∑—ã (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)**
```bash
docker system prune -af
docker volume prune -f
```

**–®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç**
```bash
df -h
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 20% —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
```

---

## 3. 502/504 –æ—à–∏–±–∫–∏

### –°–∏–º–ø—Ç–æ–º—ã
- Nginx –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 502 Bad Gateway
- Nginx –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 504 Gateway Timeout
- –°–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
systemctl status hlr-checker

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–ª—É—à–∞–µ—Ç –ª–∏ –ø–æ—Ä—Ç 3000
netstat -tlnp | grep 3000

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Nginx
tail -50 /var/log/nginx/error.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
journalctl -u hlr-checker -n 50
```

### –†–µ—à–µ–Ω–∏–µ

**–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ:**
```bash
systemctl start hlr-checker
systemctl status hlr-checker
```

**–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ, –Ω–æ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
systemctl restart hlr-checker

# –ü–æ–¥–æ–∂–¥–∞—Ç—å 10 —Å–µ–∫—É–Ω–¥
sleep 10

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health
curl -s http://localhost:3000/api/health
```

**–ï—Å–ª–∏ 504 (—Ç–∞–π–º–∞—É—Ç):**
```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –≤ Nginx
nano /etc/nginx/sites-available/hlr-checker

# –î–æ–±–∞–≤–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å:
# proxy_read_timeout 300;
# proxy_connect_timeout 300;
# proxy_send_timeout 300;

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Nginx
nginx -t && systemctl reload nginx
```

**–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ø–∞–º—è—Ç–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–º—è—Ç—å
free -m

# –ï—Å–ª–∏ –º–∞–ª–æ ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
systemctl restart hlr-checker
```

---

## 4. Seven.io –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç

### –°–∏–º–ø—Ç–æ–º—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–Ω–∏–º–∞—é—Ç > 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –Ω–æ–º–µ—Ä
- –¢–∞–π–º–∞—É—Ç—ã –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ
- –ë–∞—Ç—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ—á–µ–Ω—å –¥–æ–ª–≥–æ

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ Seven.io
time curl -s -o /dev/null -w "%{time_total}" \
  -X GET "https://gateway.seven.io/api/balance" \
  -H "X-Api-Key: YOUR_API_KEY"

# –ù–æ—Ä–º–∞–ª—å–Ω–æ: < 1 —Å–µ–∫—É–Ω–¥—ã
# –ú–µ–¥–ª–µ–Ω–Ω–æ: 1-5 —Å–µ–∫—É–Ω–¥
# –ö—Ä–∏—Ç–∏—á–Ω–æ: > 5 —Å–µ–∫—É–Ω–¥
```

### –†–µ—à–µ–Ω–∏–µ

**–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Seven.io**

–ü–æ—Å–µ—Ç–∏—Ç–µ [status.seven.io](https://status.seven.io/) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞.

**–®–∞–≥ 2: –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Seven.io**
```bash
# –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –±–∞—Ç—á–∏
mysql -u hlr_user -p hlr_checker -e "
UPDATE hlr_batches SET status = 'paused' WHERE status = 'processing';
"

# –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ –∑–∞–¥–µ—Ä–∂–∫–∞—Ö
```

**–®–∞–≥ 3: –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è (DNS, —Å–µ—Ç—å)**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS
nslookup gateway.seven.io

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç
traceroute gateway.seven.io

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall
iptables -L -n | grep -i drop
```

**–®–∞–≥ 4: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç**

–í –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –¥–ª—è Seven.io API (—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫).

**–®–∞–≥ 5: –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è Seven.io**
```bash
# –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –±–∞—Ç—á–∏
mysql -u hlr_user -p hlr_checker -e "
UPDATE hlr_batches SET status = 'processing' WHERE status = 'paused';
"

# –ò–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```

---

## 5. –ú–∞—Å—Å–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –±–∞—Ç—á–µ–π

### –°–∏–º–ø—Ç–æ–º—ã
- –ú–Ω–æ–≥–æ –±–∞—Ç—á–µ–π —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `failed`
- –û—à–∏–±–∫–∏ `SEVEN_IO_ERROR` –≤ –ª–æ–≥–∞—Ö
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∂–∞–ª—É—é—Ç—Å—è –Ω–∞ –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–∞—Ç—á–∞–º
mysql -u hlr_user -p hlr_checker -e "
SELECT status, COUNT(*) as count 
FROM hlr_batches 
WHERE created_at > DATE_SUB(NOW(), INTERVAL 24 HOUR)
GROUP BY status;
"

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
mysql -u hlr_user -p hlr_checker -e "
SELECT id, name, status, created_at 
FROM hlr_batches 
WHERE status = 'failed' 
ORDER BY created_at DESC 
LIMIT 10;
"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –æ—à–∏–±–æ–∫
journalctl -u hlr-checker --since "1 hour ago" | grep -i error | head -50
```

### –†–µ—à–µ–Ω–∏–µ

**–ï—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ ‚Äî Seven.io (429, –±–∞–ª–∞–Ω—Å, API):**

–°–º. —Ä–∞–∑–¥–µ–ª—ã [Seven.io –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç](#4-sevenio-–º–µ–¥–ª–µ–Ω–Ω–æ-–æ—Ç–≤–µ—á–∞–µ—Ç) –∏ OPERATIONS.md.

**–ï—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**

–°–º. —Ä–∞–∑–¥–µ–ª [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞](#1-–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö-–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞).

**–ï—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ ‚Äî –±–∞–≥ –≤ –∫–æ–¥–µ:**
```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é
cd /home/hlr/hlr-checker
git log --oneline -5  # –ù–∞–π—Ç–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç
git checkout <previous_commit>
pnpm install
pnpm build
systemctl restart hlr-checker
```

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å—à–∏—Ö –±–∞—Ç—á–µ–π:**
```bash
mysql -u hlr_user -p hlr_checker -e "
-- –°–±—Ä–æ—Å–∏—Ç—å –∑–∞–≤–∏—Å—à–∏–µ –±–∞—Ç—á–∏ –≤ paused
UPDATE hlr_batches 
SET status = 'paused' 
WHERE status = 'processing' 
  AND updated_at < DATE_SUB(NOW(), INTERVAL 30 MINUTE);
"
```

---

## 6. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

### –°–∏–º–ø—Ç–æ–º—ã
- `systemctl status hlr-checker` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `failed`
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤ –ª–æ–≥–∞—Ö
- –ü–æ—Ä—Ç 3000 –Ω–µ —Å–ª—É—à–∞–µ—Ç

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
systemctl status hlr-checker

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
journalctl -u hlr-checker -n 100

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
cd /home/hlr/hlr-checker
node dist/index.js
```

### –†–µ—à–µ–Ω–∏–µ

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "Cannot find module":**
```bash
cd /home/hlr/hlr-checker
pnpm install
pnpm build
systemctl restart hlr-checker
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "EADDRINUSE" (–ø–æ—Ä—Ç –∑–∞–Ω—è—Ç):**
```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 3000
lsof -i :3000

# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
kill -9 <PID>

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
systemctl start hlr-checker
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤ .env:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª
cat /home/hlr/hlr-checker/.env

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
grep -E "^(DATABASE_URL|SEVEN_IO|JWT)" /home/hlr/hlr-checker/.env
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:**

–°–º. —Ä–∞–∑–¥–µ–ª [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞](#1-–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö-–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞).

**–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç ‚Äî –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
cd /home/hlr/hlr-checker
git pull origin main
rm -rf node_modules
pnpm install
pnpm build
systemctl restart hlr-checker
```

---

## 7. –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ CPU/RAM

### –°–∏–º–ø—Ç–æ–º—ã
- –°–µ—Ä–≤–µ—Ä –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç
- `top` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 100% CPU –∏–ª–∏ –≤—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RAM
- Swap –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –û–±—â–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
top -bn1 | head -20

# –ü—Ä–æ—Ü–µ—Å—Å—ã –ø–æ CPU
ps aux --sort=-%cpu | head -10

# –ü—Ä–æ—Ü–µ—Å—Å—ã –ø–æ –ø–∞–º—è—Ç–∏
ps aux --sort=-%mem | head -10

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
free -m

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ swap
swapon --show
```

### –†–µ—à–µ–Ω–∏–µ

**–ï—Å–ª–∏ –≤–∏–Ω–æ–≤–Ω–∏–∫ ‚Äî Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
systemctl restart hlr-checker

# –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
# –î–æ–±–∞–≤–∏—Ç—å –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ –≤ systemd
nano /etc/systemd/system/hlr-checker.service
# –î–æ–±–∞–≤–∏—Ç—å: MemoryLimit=1G

systemctl daemon-reload
systemctl restart hlr-checker
```

**–ï—Å–ª–∏ –≤–∏–Ω–æ–≤–Ω–∏–∫ ‚Äî MySQL:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
mysql -u root -p -e "SHOW PROCESSLIST;"

# –£–±–∏—Ç—å –∑–∞–≤–∏—Å—à–∏–π –∑–∞–ø—Ä–æ—Å
mysql -u root -p -e "KILL <process_id>;"

# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
mysql -u hlr_user -p hlr_checker -e "
OPTIMIZE TABLE hlr_results;
OPTIMIZE TABLE hlr_batches;
"
```

**–ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç RAM:**
```bash
# –î–æ–±–∞–≤–∏—Ç—å swap (–µ—Å–ª–∏ –Ω–µ—Ç)
fallocate -l 2G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile

# –î–æ–±–∞–≤–∏—Ç—å –≤ /etc/fstab –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–∞
echo '/swapfile none swap sw 0 0' >> /etc/fstab
```

---

## –ß–µ–∫–ª–∏—Å—Ç –ø–æ—Å–ª–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞

–ü–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ª—é–±–æ–≥–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞:

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint: `curl http://localhost:3000/api/health`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–æ–≤—ã–µ –æ—à–∏–±–∫–∏
- [ ] –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
- [ ] –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç (–≤—Ä–µ–º—è, –ø—Ä–∏—á–∏–Ω–∞, —Ä–µ—à–µ–Ω–∏–µ)
- [ ] –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –Ω–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã —ç—Å–∫–∞–ª–∞—Ü–∏–∏

| –£—Ä–æ–≤–µ–Ω—å | –í—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏ | –ö–æ–Ω—Ç–∞–∫—Ç |
|---------|---------------|---------|
| L1 (–¥–µ–∂—É—Ä–Ω—ã–π) | 15 –º–∏–Ω | –≠—Ç–æ—Ç runbook |
| L2 (DevOps) | 1 —á–∞—Å | devops@example.com |
| L3 (—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫) | 4 —á–∞—Å–∞ | dev@example.com |

---

*Runbook –≤–µ—Ä—Å–∏—è 1.0 ‚Äî –Ø–Ω–≤–∞—Ä—å 2025*
